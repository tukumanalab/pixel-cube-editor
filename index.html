<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixel Cube Editor</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/editor.css">
  <link rel="stylesheet" href="/css/controls.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div id="app">
    <header class="app-header">
      <h1>Pixel Cube Editor</h1>
      <div class="header-actions">
        <button id="import-btn" class="btn-secondary">ブロックをインポート</button>
        <button id="export-btn" class="btn-primary">エクスポート</button>
      </div>
    </header>

    <!-- Toolbar Area -->
    <div class="app-toolbar">
      <div class="history-controls">
        <button id="undo-btn" class="btn-icon" title="元に戻す (Ctrl+Z)" disabled>↶ Undo</button>
        <button id="redo-btn" class="btn-icon" title="やり直し (Ctrl+Y)" disabled>↷ Redo</button>
      </div>
      <div class="brush-size-controls">
        <button id="brush-size-1" class="btn-brush active" title="細いペン (1px)">●</button>
        <button id="brush-size-2" class="btn-brush" title="中太ペン (2px)">●</button>
        <button id="brush-size-3" class="btn-brush" title="太いペン (3px)">●</button>
      </div>
      <div class="color-controls">
        <input type="color" id="color-picker" value="#000000">
        <button id="add-color-btn" class="btn-icon" title="パレットに追加">→</button>
      </div>
      <div class="palette-container">
        <div id="palette-grid" class="palette-grid"></div>
        <div id="face-colors-grid" class="palette-grid face-colors-grid"></div>
      </div>
    </div>

    <div class="app-layout">
      <!-- Main Section: Preview and Editor -->
      <div class="main-section">
        <!-- 3D Preview -->
        <div class="preview-section">
          <div id="three-preview" class="preview-container"></div>
        </div>

        <!-- Pixel Editor -->
        <div class="editor-section">
          <!-- Face Selector -->
          <div class="face-selector">
            <div class="face-tabs">
              <button class="face-tab active" data-face="front">Front</button>
              <button class="face-tab" data-face="back">Back</button>
              <button class="face-tab" data-face="left">Left</button>
              <button class="face-tab" data-face="right">Right</button>
              <button class="face-tab" data-face="top">Top</button>
              <button class="face-tab" data-face="bottom">Bottom</button>
            </div>
          </div>
          <div id="pixel-grid-container" class="pixel-grid-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="import-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ブロックをインポート</h2>
        <button id="close-import-modal-btn" class="close-btn">&times;</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="block-selector">ブロックを選択</label>
          <select id="block-selector" class="block-selector">
            <option value="">読み込み中...</option>
          </select>
        </div>
        <div id="block-preview" class="block-preview" style="display: none;">
          <p>プレビュー:</p>
          <div id="block-preview-images"></div>
        </div>
      </div>

      <div class="modal-footer">
        <button id="cancel-import-btn" class="btn-secondary">キャンセル</button>
        <button id="execute-import-btn" class="btn-primary" disabled>インポート</button>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div id="export-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>エクスポート設定</h2>
        <button id="close-modal-btn" class="close-btn">&times;</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>エクスポート種別</label>
          <div class="radio-group">
            <label>
              <input type="radio" name="export-type" value="png" checked>
              PNG (全6面)
            </label>
            <label>
              <input type="radio" name="export-type" value="pdf">
              PDF (全6面)
            </label>
            <label>
              <input type="radio" name="export-type" value="papercraft">
              展開図
            </label>
          </div>
        </div>

        <div class="form-group">
          <label for="face-size">一辺のサイズ: <span id="size-value">40</span>mm</label>
          <input type="range" id="face-size" min="10" max="50" value="40" step="1">
        </div>
      </div>

      <div class="modal-footer">
        <button id="cancel-export-btn" class="btn-secondary">キャンセル</button>
        <button id="execute-export-btn" class="btn-primary">エクスポート</button>
      </div>
    </div>
  </div>

  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/examples/jsm/controls/OrbitControls.js": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js"
      }
    }
  </script>
  <script type="module" src="/js/main.js"></script>
</body>
</html>
